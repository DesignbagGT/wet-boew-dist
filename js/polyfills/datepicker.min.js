/*
 * @title WET-BOEW Calendar library
 * @overview A library for building calendar interfaces
 * @license wet-boew.github.io/wet-boew/License-en.html / wet-boew.github.io/wet-boew/Licence-fr.html
 * @author @pjackson28
 */
!function(a,b,c,d){"use strict";var e,f,g,h="input[type=date]",i=d.doc,j=new Date,k=j.getMonth(),l=j.getFullYear(),m="YYYY-MM-DD",n=!1,o=function(c){var i=c.target,j=i.id,k=d.getMode()+".js";b._timer.remove(h),-1===i.className.indexOf("picker-field")&&(f||(e=b.i18n,f={datepickerShow:e("%datepicker-show")+e("%interword-space"),datepickerHide:e("%datepicker-hide"),datepickerSelected:e("%datepicker-selected")}),i.className+=" picker-field",g||(g=a("<div id='wb-picker' class='picker-overlay' role='dialog' aria-hidden='true'></div>"),a("<a class='picker-close' role='button' href='javascript:;'><img src='"+d.getPath("/assets")+"/cross-button.png' alt='"+f.datepickerHide+"' /></a>").appendTo(g).click(function(a){var b=a.which;b&&1!==b||t(g.attr("aria-controls"))}),g.find("a").attr("tabindex","-1"),a("body > main > div").after(g)),j&&p(j),b.Modernizr.load({load:"site!deps/xregexp"+k}),n=!0)},p=function(b){var c=a("label[for="+b+"]").text(),e="<a id='"+b+"-picker-toggle' class='picker-toggle' href='javascript:;'><img src='"+d.getPath("/assets")+"/calendar-month.png' alt='"+f.datepickerShow+c+"'/></a>";a("#"+b).after(e),g.slideUp(0)},q=function(b,e,f,g,h){var i,j,k=c.getElementById(b),l=k.getAttribute("min"),m=k.getAttribute("max"),n=d.date.fromDateISO;l=n(l?l:"1800-01-01"),m=n(m?m:"2100-01-01"),i=e===l.getFullYear()&&f===l.getMonth(),j=e===m.getFullYear()&&f===m.getMonth(),g.each(function(c,d){if(!i&&!j||i===!0&&c>=l.getDate()||j===!0&&c<=m.getDate()){var k=a(d).children("div"),n=a("<a href='javascript:;'></a>"),o=k.parent();o.empty(),n.append(k.html()),n.appendTo(o),n.on("click vclick touchstart",{fieldId:b,year:e,month:f,day:c+1,days:g,format:h},function(b){var c=b.which,d=b.data.fieldId,e=b.data.year,f=b.data.month,g=b.data.format;if(!c||1===c){var h=a("#"+b.data.fieldId),i=h.val();return h.val(w(e,f+1,b.data.day,g)),i!==h.val()&&h.trigger("change"),s(d,e,f,b.data.days,g),t(d),!1}})}})},r=function(a,b,c,d,e,f){f.getTime()<d.getTime()?(f=d,f.setDate(f.getDate()+1)):f.getTime()>e.getTime()&&(f=e,f.setDate(f.getDate()+1)),(f.getMonth()!==c||f.getFullYear()!==b)&&i.trigger("create.wb-calendar",[a,f.getFullYear(),f.getMonth(),!0,d,e]),g.find(".cal-day-list").children("li:eq("+(f.getDate()-1)+")").children("a").trigger("focus.wb")},s=function(b,d,e,g,h){var i,j,k,l;a(g).removeClass("datepicker-selected").find(".datepicker-selected-text").detach(),h=h.replace("DD","(?<a> [0-9]{2})").replace("D","(?<a> [0-9] )").replace("MM","(?<b> [0-9]{2})").replace("M","(?<b> [0-9])").replace("YYYY","(?<c> [0-9]{4})").replace("YY","(?<c /> [0-9]{2})"),i="^"+h+"$",j=c.getElementById(b).value,l=new XRegExp(i,"x");try{""!==j&&(k=a.parseJSON(j.replace(l,'{"year":"$1", "month":"$2", "day":"$3"}')),parseInt(k.year,10)===d&&parseInt(k.month,10)===e+1&&a(g[k.day-1]).addClass("datepicker-selected").children("a").append("<span class='wb-invisible datepicker-selected-text'> ["+f.datepickerSelected+"]</span>"))}catch(m){}},t=function(b){var e,h,j=c.getElementById(b),m=a(j),n=j.getAttribute("min"),o=j.getAttribute("max"),p=a("#"+b+"-picker-toggle"),q=d.date.fromDateISO,s=q(j.value);n||(n="1800-01-01"),o||(o="2100-01-01"),g.attr({"aria-labelledby":b+"-picker-toggle","aria-controls":b}),i.trigger("create.wb-calendar",["wb-picker",l,k,!0,n,o]),m.after(g),g.unbind("focusout.calendar").unbind("focusin.calendar"),"false"!==g.attr("aria-hidden")?(u(b),g.slideDown("fast").attr("aria-hidden","false").find("a").attr("tabindex",0),p.children("a").children("span").text(f.datepickerHide),null!==s?(s.setDate(s.getDate()+1),r("wb-picker",l,k,q(n),q(o),s)):(e=g.find(".cal-prevmonth a"),0!==e.length?e.trigger("focus.wb"):(h=g.find(".cal-nextmonth a"),0!==h.length?h.trigger("focus.wb"):g.find(".cal-goto a").trigger("focus.wb")))):(v(b),m.trigger("focus.wb"))},u=function(b){var c,d,e=a(".picker-field").get(),f=e.length;for(c=0;c!==f;c+=1)d=e[c].id,d!==b&&v(d)},v=function(b){var c=a("#"+b+"-picker-toggle"),d=a("label[for="+b+"]").text();g.find("a").attr("tabindex","-1"),g.slideUp("fast").attr("aria-hidden","true").trigger("hideGoToForm.wb-calendar"),c.children("a").children("span").text(f.datepickerShow+d)},w=function(a,b,c,e){var f=d.string.pad;return e.replace("DD",f(c,2)).replace("D",c).replace("MM",f(b,2)).replace("M",b).replace("YYYY",a).replace("YY",a.toString().substr(2,2))};i.on("timerpoke.wb",h,o),i.on("click vclick touchstart focusin",function(b){var d,e=b.which;return!n||e&&1!==e||(d=c.getElementById("wb-picker"),"false"!==d.getAttribute("aria-hidden")||a.contains(d,b.target))?void 0:(v(d.getAttribute("aria-controls")),!1)}),i.on("keydown",".cal-day-list a",function(b){var e,f,h=a(this),i=g.attr("id"),j=this.className,m=j.substring(j.indexOf("cal-index-")),n=b.which,o=b.shiftKey,p=c.getElementById(g.attr("aria-controls")),q=p.getAttribute("min"),s=p.getAttribute("max"),u=d.date.fromDateISO;if(q=u(q?q:"1800-01-01"),s=u(s?s:"2100-01-01"),b.ctrlKey||b.altKey||b.metaKey){if(b.ctrlKey&&!b.altKey&&!b.metaKey){if(35===n)return e=new Date(l,11,31),!1;36===n&&(e=new Date(l,0,1))}}else switch(n){case 27:return t(g.attr("aria-controls")),!1;case 32:return h.trigger("click"),!1;case 33:e=o?new Date(l-1,k,m+1):new Date(l,k-1,m+1);break;case 34:e=o?new Date(l+1,k,m+1):new Date(l,k+1,m+1);break;case 35:case 36:return f=h.closest("ol").find("li a"),f.eq(35===n?f.length-1:0).trigger("focus.wb"),!1;case 37:e=new Date(l,k,m);break;case 38:e=new Date(l,k,m-6);break;case 39:e=new Date(l,k,m+2);break;case 40:e=new Date(l,k,m+8)}return e?(r(i,l,k,q,s,e),!1):void 0}),i.on("keydown calendarDisplayed.wb-calendar","#wb-picker",function(b,c,d,e){var f=a(this),g=b.type,h=b.which,i=f.attr("aria-controls");switch(g){case"keydown":27===h&&(u(),a("#"+i).trigger("focus.wb"));break;case"calendarDisplayed":q(i,c,d,e,m),s(i,c,d,e,m);break;case"click":case"vclick":case"touchstart":case"focusin":f.attr("aria-hidden")===!1&&(h&&1!==h||(b.stopPropagation?b.stopImmediatePropagation():b.cancelBubble=!0))}}),i.on("click vclick touchstart",".picker-toggle",function(a){var b,c=a.which;return c&&1!==c?void 0:(b=this.id,t(b.substring(0,b.indexOf("-picker-toggle"))),!1)}),b._timer.add(h)}(jQuery,window,document,vapour);